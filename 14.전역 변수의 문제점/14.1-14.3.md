# 14장 전역 변수의 문제점

## 목차

- [변수의 생명 주기](#14.1)
	- [지역 변수의 생명 주기](#14.1.1)
	- [전역 변수의 생명 주기](#14.1.2)
- [전역 변수의 문제점](#14.2)
- [전역 변수의 사용을 억제하는 방법](#14.3)
  - [즉시 실행 함수](#14.3.1)
  - [네임스페이스 객체](#14.3.2)
  - [모듈 패턴](#14.3.3)
  - [ES6 모듈](#14.3.4)

## 14.1 변수의 생명주기<a name="14.1"></a>

### 14.1.1 지역 변수의 생명주기<a name="14.1.1"></a>

- 생명 주기
	- 자신이 선언된 위치에 생성되고 소멸
	- 전역 변수의 생명 주기는 애플리케이션의 생명 주기와 동일
	- 함수 내부에 선언된 지역 변수는 함수가 호출되면 생성되고 함수가 종료하면 소멸함

- 전역 변수
	- 코드가 한 줄씩 순차적으로 실행되는 시점인 런타임에 실행되는 것이 아니라 런타임 이전 단계에서 자바스크립트 엔진에 의해 먼저 실행됨

- 지역 변수
	- 자바스크립트 엔진에 의해 먼저 실행되어, 함수가 호출된 직후에 함수 몸체의 코드가 순차적으로 실행보다 빠름
	- 생명주기
		- 함수의 생명 주기와 일치
		- 지역 변수가 함수보다 오래 생존하는 경우도 존재
	- 함수가 생성한 스코프에 등록됨
		- 렉시컬 환경이라 부르는 물리적인 실체가 존재하여, 자신이 등록된 스코프가 소멸될 때까지 유효함
		- 할당된 메모리 공간은 참조하지 않을 때, 변수와 가비지 콜렉터에 의해 해제됨

- 스코프
	- 함수 종료 시 함수가 생성한 스코프도 소멸함
	- 스코프 참조 시, 해제되지 않고 생존
	- 호이스팅에 의해 스코프는 단위로 동작

- 호이스팅
	- 변수 선언이 스코프의 선두로 끌어 올려진 것처럼 동작하는 자바스크립트 고유의 특징

### 14.1.2 전역 변수의 생명 주기<a name="14.1.2"></a>

- 전역 코드
	- 명시적인 호출 없이 실행됨
	- 전역 코드를 실행하는 특별한 진입점 없음
	- 코드 로드 시 곧바로 해석되고 실행됨
		- 반환문을 사용할 수 없어 마지막 문이 실행되어 더 이상 실행할 문이 없을 때 종료
	- var 키워드로 선언한 전역 변수는 전역 객체의 프로퍼티가 됨
		- 전역 변수의 생명 주기가 전역 객체의 생명 주기와 일치함

- 함수
	- 함수 몸체의 마지막 문 또는 반환문이 실행되면 종료

- window
	- 브라우저 환경에서의 전역 객체
	- 웹페이지를 닫기 전까지 유효
	- window의 프로퍼티
		- var 키워드로 선언한 전역 변수
			- window와 동일하게 웹페이지를 닫을 때까지 유효함
			- var의 생명주기는 전역 객체의 생명주기와 일치


## 14.2 전역 변수의 문제점<a name="14.2"></a>

- 암묵적 결합
	- 모든 코드가 전역 변수를 참조하고 변경 가능
	- 변수의 유효 범위가 클수록 가독성은 나빠지며 상태 변경의 위험성 증가

- 긴 생명주기
	- 메모리 리소스를 오랜 기간 소비
	- 전역 변수의 상태를 변경할 수 있는 시간이 길고 기회가 많음
	- 변수의 중복 선언을 허용하여, 변수 이름이 중복될 가능성이 높음
		- 변수 이름 중복 시, 의도치 않은 재할당이 이뤄짐

- 스코프 체인 상에서 종점에 존재
	- 변수 검색 시, 전역 변수가 가장 마지막에 검색됨
		- 검색 속도가 가장 느림

- 네임스페이스 오염
	- 파일이 분리되어 있어도 하나의 전역 스코프를 공유하는 문제 존재
		- 다른 파일 내에서 동일한 이름으로 명명된 전역 변수나 전역 함수가 같은 스코프 내에 존재할 가능성 존재


## 14.3 전역 변수의 사용을 억제하는 방법<a name="14.3"></a>

- 전역 변수를 반드시 사용해야 할 이유를 찾지 못한 경우 지역 변수를 사용해야 함
	- 변수의 스코프는 좁을수록 좋음

### 14.3.1 즉시 실행 함수<a name="14.3.1"></a>

- 단 한 번만 호출됨
- 모든 코드를 즉시 실행 함수로 감싸면 모든 변수는 즉시 실행 함수의 지역 변수가 됨

### 14.3.2 네임스페이스 객체<a name="14.3.2"></a>

- 프로퍼티 추가
	- 전역에 네임스페이스 역할을 담당할 객체 생성 후 전역 변수처럼 사용하고 싶은 변수를 프로퍼티로 추가하는 방법
	- 네임스페이스 객체에 또 다른 네임스페이스 객체를 프로퍼티로 추가해서 네임스페이스를 계층적 구성 가능
	- 식별자 충돌 방지 효과는 있으나, 네임스페이스 객체 자체가 전역 변수에 할당되어 유용하지 않음

```js
var MYAPP = {} // 전역 네임스페이스 객체

MYAPP.name = 'Lee';

console.log(MYAPP.name); // Lee
```

### 14.3.3 모듈 패턴<a name="14.3.3"></a>

- 모듈 패턴이란?
	- 클래스 모방해서 즉시 실행 함수로 감싸 하나의 모듈을 만듦
	- 클로저 기반으로 동작

- 모듈 패턴의 특징
	- 전역 변수의 억제
	- 캡슐화 구현
		- 객체의 상태를 나타내는 프로퍼티와 프로퍼티를 참조하고 조작할 수 있는 동작인 메서드를 하나로 묶는 것을 말함
		- 객체의 특정 프로퍼티나 메서드를 감출 목적으로 사용하기도 함
			- 다른 말로 `정보 은닉`이라고 함

- 자바스크립트는 public, private, protected 등 접근 제한자를 제공하지 않아서 대신 모듈 패턴의 전역 네임 스페이이스의 오염을 막는 기능을 사용

- 자바스크립트에서의 퍼블릭 멤버
	- 반환되는 객체의 프로퍼티

- 자바스크립트에서의 프라이빗 멤버
	- 반환하는 객체에 추가하지 않으면 외부에서 접근 불가능

### 14.3.4 ES6 모듈<a name="14.3.4"></a>

- ES6 모듈의 특징
	- ES6 모듈 사용 시, 전역 변수 사용 불가능
	- 파일 자체의 독자적인 모듈 스코프 제공
	- var 키워드로 선언한 변수
		- 전역 변수, window 객체의 프로퍼티가 아님
	- 모던 브라우저에서 ES6 사용 가능
		- Chrome 61, FF 60, SF 10.1, Edge 16 이상
	- `script` 태그에 `type="module"` 어트리뷰트 추가
		- 로드된 자바스크립트 파일은 모듈로서 동작
		- 모듈의 권장 파일 확장자: `mjs`
	- IE를 포함한 구형 브라우저에서 동작하지 않음
		- 트랜스파일링, 번들링 필요로 인해 ES6 모듈 기능이 아닌 Webpack 등의 모듈 번들러를 사용하는 것이 일반적임